# 图片水印工具 PRD (Product Requirements Document)

## 1. 项目概述

### 1.1 项目名称
图片水印工具 (Photo Watermark Tool)

### 1.2 项目描述
开发一个基于Python的命令行程序，能够自动读取图片的EXIF信息中的拍摄时间，并将其作为水印添加到图片上。

### 1.3 目标用户
- 摄影师
- 图片处理爱好者
- 需要批量添加时间水印的用户

## 2. 功能需求

### 2.1 核心功能

#### 2.1.1 图片路径输入
- **功能描述**: 用户通过命令行参数输入图片文件路径
- **输入方式**: 命令行参数或交互式输入
- **支持格式**: 常见图片格式 (JPG, JPEG, PNG, TIFF等)
- **验证要求**: 检查路径是否存在，是否为有效图片文件

#### 2.1.2 EXIF信息读取
- **功能描述**: 读取图片EXIF信息中的拍摄时间
- **数据提取**: 提取年月日信息 (YYYY-MM-DD格式，不选取时间)
- **异常处理**: 当EXIF信息不存在或损坏时的处理机制
- **默认行为**: 如果无法获取拍摄时间，使用文件修改时间或当前时间

#### 2.1.3 水印配置
- **字体大小**: 用户可自定义水印文字大小
- **字体颜色**: 支持RGB颜色值或预定义颜色名称
- **位置设置**: 支持多个预设位置(默认预设左上角)
  - 左上角 (top-left)
  - 右上角 (top-right)
  - 左下角 (bottom-left)
  - 右下角 (bottom-right)
  - 居中 (center)
  - 自定义坐标

#### 2.1.4 水印绘制
- **文本渲染**: 将时间信息绘制到图片上
- **字体选择**: 使用系统默认字体或指定字体
- **透明度**: 支持设置水印透明度
- **边框效果**: 可选添加文字边框以提高可读性

#### 2.1.5 文件保存
- **输出目录**: 在原目录下创建 `原目录名_watermark` 子目录
- **文件命名**: 保持原文件名，添加后缀标识
- **格式保持**: 保持原图片格式和质量
- **批量处理**: 支持处理目录下所有图片文件

### 2.2 高级功能

#### 2.2.1 批量处理
- 支持处理单个文件或整个目录
- 显示处理进度
- 错误日志记录

#### 2.2.2 配置文件
- 支持保存用户偏好设置
- 可重复使用配置

## 3. 技术规格

### 3.1 开发环境
- **编程语言**: Python 3.7+
- **主要依赖库**:
  - `Pillow (PIL)`: 图片处理
  - `exifread` 或 `piexif`: EXIF信息读取
  - `argparse`: 命令行参数解析
  - `pathlib`: 路径处理

### 3.2 系统要求
- **操作系统**: Windows, macOS, Linux
- **Python版本**: 3.7及以上
- **内存要求**: 最低512MB RAM
- **存储空间**: 50MB (包含依赖)

### 3.3 性能要求
- **处理速度**: 单张图片处理时间 < 2秒
- **内存使用**: 处理大图片时内存占用 < 1GB
- **并发处理**: 支持多线程批量处理

## 4. 用户界面设计

### 4.1 命令行界面

#### 4.1.1 基本用法
```bash
python watermark_tool.py <图片路径> [选项]
```

#### 4.1.2 参数说明
- `--input, -i`: 输入图片文件或目录路径
- `--font-size, -s`: 字体大小 (默认: 24)
- `--color, -c`: 字体颜色 (默认: white)
- `--position, -p`: 水印位置 (默认: bottom-right)
- `--opacity, -o`: 透明度 (0-1, 默认: 0.8)
- `--output, -out`: 输出目录 (可选)
- `--help, -h`: 显示帮助信息

#### 4.1.2 使用示例
```bash
# 基本使用
python watermark_tool.py photo.jpg

# 自定义设置
python watermark_tool.py photo.jpg --font-size 30 --color red --position top-left

# 批量处理
python watermark_tool.py /path/to/photos --font-size 20 --position bottom-right
```

### 4.2 交互模式
- 当未提供参数时，进入交互模式
- 逐步引导用户输入所需信息
- 提供默认选项和示例

## 5. 错误处理

### 5.1 输入验证
- 检查文件路径有效性
- 验证图片格式支持
- 检查EXIF信息完整性

### 5.2 异常情况
- 文件权限不足
- 磁盘空间不足
- 图片文件损坏
- EXIF信息缺失

### 5.3 错误信息
- 提供清晰的错误描述
- 建议解决方案
- 记录详细日志

## 6. 测试计划

### 6.1 功能测试
- 单文件处理测试
- 批量处理测试
- 不同图片格式测试
- 各种EXIF情况测试

### 6.2 性能测试
- 大文件处理测试
- 批量处理性能测试
- 内存使用监控

### 6.3 兼容性测试
- 不同操作系统测试
- 不同Python版本测试
- 各种图片格式兼容性

## 7. 部署和分发

### 7.1 打包方式
- 使用 `pyinstaller` 创建可执行文件
- 提供 `requirements.txt` 依赖文件
- 创建安装脚本

### 7.2 文档
- 用户手册
- API文档
- 示例和教程

## 8. 未来扩展

### 8.1 功能扩展
- 支持更多水印类型 (图片水印、Logo)
- 批量重命名功能
- 图片格式转换
- 水印模板系统

### 8.2 界面改进
- 图形用户界面 (GUI)
- Web界面
- 移动端应用

## 9. 项目时间线

### 9.1 开发阶段
- **阶段1** (1周): 核心功能开发
- **阶段2** (1周): 用户界面和参数处理
- **阶段3** (1周): 测试和优化
- **阶段4** (0.5周): 文档和打包

### 9.2 里程碑
- MVP版本完成
- 功能测试通过
- 用户文档完成
- 正式发布

## 10. 风险评估

### 10.1 技术风险
- EXIF信息读取兼容性
- 大文件处理性能
- 不同系统兼容性

### 10.2 缓解措施
- 充分的测试覆盖
- 多种EXIF库备选方案
- 渐进式功能发布

---

**文档版本**: 1.0  
**创建日期**: 2025年  
**最后更新**: 2025年  
**负责人**: 并非开发团队
